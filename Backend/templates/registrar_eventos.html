<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Evento</title>
  <link rel="icon" href="{{ url_for('static', filename='SIGEA_LOGOTIPO200.png') }}" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
  <style>
      :root {
        --guinda: #811B49;
        --dorado: #DCCB88;
        --verde: #76C043;
        --blanco: #fff;
        --gris-claro: #F2F2F2;
        --negro: #1C1C1C;
      }
      body {
        font-family: 'Open Sans', Arial, sans-serif;
        background: var(--gris-claro);
        margin: 0;
        padding: 0;
      }
      .sigea-header {
        width: 100%;
        height: 90px;
        background: var(--guinda);
        color: var(--blanco);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.3rem;
        font-weight: bold;
        letter-spacing: 0.12em;
        margin-bottom: 30px;
        box-shadow: 0 2px 12px rgba(129,27,73,0.08);
      }
      h2 {
        color: var(--guinda);
        text-align: center;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 18px;
        letter-spacing: 0.04em;
      }
      form {
        max-width: 650px;
        margin: 40px auto;
        background: var(--blanco);
        padding: 32px 28px;
        border-radius: 18px;
        box-shadow: 0 2px 16px rgba(129,27,73,0.10);
      }
      label {
        display: block;
        margin-top: 12px;
        font-weight: 700;
        color: var(--guinda);
        letter-spacing: 0.03em;
      }
      input[type="text"],
      select,
      textarea {
        width: 100%;
        padding: 10px 14px;
        margin-top: 5px;
        box-sizing: border-box;
        border: 1.5px solid #C8C8C8;
        border-radius: 8px;
        font-size: 1rem;
        background: var(--gris-claro);
        font-family: 'Open Sans', Arial, sans-serif;
        margin-bottom: 8px;
      }
      input[type="text"]:focus,
      select:focus,
      textarea:focus {
        border-color: var(--guinda);
        outline: none;
        background: #fff;
      }
      .row {
        display: flex;
        gap: 10px;
      }
      .row > div {
        flex: 1;
      }

      input[type="datetime-local"] {
        width: 100%;
        padding: 10px 14px;
        margin-top: 5px;
        box-sizing: border-box;
        border: 1.5px solid #C8C8C8;
        border-radius: 8px;
        font-size: 1rem;
        background: var(--gris-claro);
        font-family: 'Open Sans', Arial, sans-serif;
        margin-bottom: 8px;
        color: var(--negro);
      }

      input[type="datetime-local"]:focus {
        border-color: var(--guinda);
        outline: none;
        background: #fff;
      }

      input[type="number"] {
        width: 100px;
        padding: 10px 14px;
        margin-top: 5px;
        box-sizing: border-box;
        border: 1.5px solid #C8C8C8;
        border-radius: 8px;
        font-size: 1rem;
        background: var(--gris-claro);
        font-family: 'Open Sans', Arial, sans-serif;
        margin-bottom: 8px;
        color: var(--negro);
      }

      input[type="number"]:focus {
        border-color: var(--guinda);
        outline: none;
        background: #fff;
      }

      .button-group {
        display: flex;
        justify-content: center;
        gap: 18px;
        margin-top: 24px;
      }
      button {
          padding: 8px 18px;
          font-size: 1rem;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 700;
          margin-left: 10px;
          background-color: var(--guinda);
          color: var(--blanco);
          transition: background 0.2s, color 0.2s;
      }

      button:hover {
        background-color: var(--dorado);
        color: var(--negro);
      }
      .borrador {
        background-color: var(--dorado);
        color: var(--negro);
      }
      .borrador:hover {
        background-color: #e6d9a7;
      }
      .aprobar {
        background-color: var(--guinda);
        color: var(--blanco);
      }
      .aprobar:hover {
        background-color: #a02a5d;
      }

      li button.desplegar {
        background: transparent;
        color: var(--guinda);
        margin-left: 0;
        margin-right: 10px;
        font-size: 1.1em;
        border: none;
        cursor: pointer;
        transition: transform 0.2s;
        padding: 0 6px;
      }
      li button.desplegar:hover {
        background: #f5e9f0;
        color: var(--guinda);
      } 
      ul {
      list-style: none;
      padding: 0;
      }
      li {
      margin-bottom: 10px;
      background: var(--gris-claro);
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 100%;
      overflow: hidden;
      flex-wrap: wrap;
      position: relative;
        }
      span {
        flex: 1;
        min-width: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
        cursor: pointer;
          }
      .detalle-div {
        width: 100%;
        background: #f5e9f0;
        color: var(--guinda);
        padding: 8px 12px;
        margin-top: 8px;
        border-radius: 6px;
        font-size: 0.98em;
        word-break: break-word;
        display: none;
      }
      .agregar-opcion {
        display: flex;
        gap: 6px;
        margin-bottom: 8px;
        align-items: center;
      }
      .agregar-opcion input[type="text"] {
        width: 70%;
        margin-bottom: 0;
      }
      .agregar-opcion button {
        margin-left: 0;
        padding: 8px 12px;
        font-size: 1.1em;
      }

    .grupo-toggle-btn {
      width: 100%;
      background: var(--guinda);
      color: var(--blanco);
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 1rem;
      font-family: 'Open Sans', Arial, sans-serif;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      margin-bottom: 8px;
      text-align: left;
    }
    .grupo-toggle-btn:hover {
      background: var(--dorado);
      color: var(--negro);
    }
    .grupo-lista {
      display: none;
      background: var(--gris-claro);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(129,27,73,0.10);
      padding: 12px;
      position: absolute;
      z-index: 10;
      min-width: 220px;
      max-height: 220px;
      overflow-y: auto;
      left: 0;
      right: 0;
    }
    .grupo-lista label {
      display: block;
      cursor: pointer;
      margin-bottom: 4px;
      font-size: 1rem;
      color: var(--guinda);
      font-family: 'Open Sans', Arial, sans-serif;
    }
    .grupo-lista input[type="checkbox"] {
      accent-color: var(--guinda);
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <div class="sigea-header">
    SIGEA
  </div>
  <h2>REGISTRO DE EVENTO</h2>
  <form>
    <label for="titulo">Título del evento</label>
    <input type="text" id="titulo" name="titulo" placeholder="Ingrese el título del evento" required>

    <div class="row">
      <div>
        <label for="categoria">Categoría</label>
        <select id="categoria" name="categoria" required>
          <option value="">Seleccione categoria</option>
        </select>
      </div>
      <div>
        <label for="impacto">Impacto</label>
        <textarea id="impacto" name="impacto" rows="2" placeholder="Escriba el impacto que se busca lograr" required></textarea>
      </div>
    </div>

    <label for="tematica">Temática</label>
    <textarea id="tematica" name="tematica" rows="5" placeholder="Escriba el tema central del evento" required></textarea>

    <label for="justificacion">Justificación</label>
    <textarea id="justificacion" name="justificacion" rows="5" placeholder="Escriba el motivo o la razon del evento" required></textarea>

    <label for="objetivo">Objetivo</label>
    <textarea id="objetivo" name="objetivo" rows="5" placeholder="Escriba la meta que busca alcanzar con este evento" required></textarea>

    <label for="dinamica">Dinámica</label>
    <textarea id="dinamica" name="dinamica" rows="5" placeholder= "Escriba la actividad o forma de participacion" required></textarea>

    <label for="lugar">Lugar del evento</label>
    <input type="text" id="lugar" name="lugar" placeholder="Ingrese lugar del evento. Ejemplo: Auditorio" required>

    <div class="row">
    <div>
      <label for="num-dias">¿Cuántos días durará el evento?</label>
      <input type="number" id="num-dias" name="num-dias" min="1" max="30" value="1" required>
      <div id="fechas-dias"></div>
    </div>

    <div>
      <label for="periodo_cuatrimestral">Periodo cuatrimestral</label>
      <select id="periodo_cuatrimestral" name="periodo_cuatrimestral" required>
          <option value="">Seleccione cuatrimestre</option>
          <option  value="enero_abril">Enero - Abril</option>
          <option  value="mayo_agosto">Mayo - Agosto</option>
          <option  value="septiembre_diciembre">Septiembre - Diciembre</option>
      </select>
    </div>
    </div>

    <!--Inicio lista editable-->
    <div class="main-container" style="box-shadow:none; padding:0; margin:0;">
      <h3 style="color:var(--guinda); font-size:1.1rem; margin-bottom:10px;">Recursos solicitados</h3>
      <input type="text" id="entrada" placeholder="Escriba los recursos que solicitara..." required>
      <button type="button" onclick="agregarElemento()">Agregar</button>
      <ul id="lista"></ul>
    </div>
    <!--Fin lista editable-->

      <div>
        <label for="docente">Docente</label>
        <select id="docente" name="docente" required>
          <option value="">Seleccione docente</option>
        </select>
        <div class="agregar-opcion">
          <input type="text" id="nuevo-docente" placeholder="Agregar docente...">
          <button type="button" onclick="agregarDocente()">+</button>
        </div>
        <div id="docentes-eliminables" style="margin-bottom:8px;"></div>
      </div>
      <div>
        <label>Grupos asignados</label>
        <br>
        <div style="position:relative;">
          <button type="button" id="toggle-grupos" class="grupo-toggle-btn">Seleccionar grupos ▼</button>
          <div id="lista-grupos" class="grupo-lista">
            <!-- Aquí se mostrarán los checkboxes -->
          </div>
          <div class="agregar-opcion" style="margin-top:8px;">
            <input type="text" id="nuevo-grupo" placeholder="Agregar grupo...">
            <button type="button" onclick="agregarGrupo()">+</button>
          </div>
          <div id="grupos-seleccionados" style="margin-top:8px; color:var(--guinda); font-size:0.98em;"></div>
        </div>
        <div id="grupos-eliminables" style="margin-bottom:8px;"></div>

      </div>
    
      <div>
        <label for="coordinador">Coordinador (opcional)</label>
        <select id="coordinador" name="coordinador" required>
          <option value="">Seleccione</option>
        </select>
        
        <div class="agregar-opcion">
          <input type="text" id="nuevo-coordinador" placeholder="Agregar coordinador...">
          <button type="button" onclick="agregarCoordinador()">+</button>
        </div>

        <div id="coordinadores-eliminables" style="margin-bottom:8px;"></div>
      </div>
    

    <div class="button-group">
      <button type="button" class="borrador">Guardar como borrador</button>
      <button type="submit" class="aprobar">Enviar para aprobación</button>
    </div>
  </form>

<script>
  // Lista editable de recursos
  function agregarElemento() {
    const entrada = document.getElementById("entrada");
    const valor = entrada.value.trim();
    if (valor !== "") {
      const lista = document.getElementById("lista");
      const li = document.createElement("li");

      // Botón desplegable ">"
      const btnDesplegar = document.createElement("button");
      btnDesplegar.type = "button";
      btnDesplegar.innerHTML = "&#x25B6;";
      btnDesplegar.title = "Mostrar/Ocultar";
      btnDesplegar.className = "desplegar";
      btnDesplegar.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (detalleDiv.style.display === "none") {
          detalleDiv.style.display = "block";
          btnDesplegar.innerHTML = "&#9662;";
        } else {
          detalleDiv.style.display = "none";
          btnDesplegar.innerHTML = "&#x25B6;";
        }
      };

      // Crear span para mostrar el texto (resumido)
      const span = document.createElement("span");
      span.title = valor;
      span.textContent = valor;
      span.ondblclick = function() {
        editarElemento(span, detalleDiv);
      };

      // Crear botón de eliminar con ícono
      const btnEliminar = document.createElement("button");
      btnEliminar.type = "button";
      btnEliminar.innerHTML = "🗑";
      btnEliminar.title = "Eliminar";
      btnEliminar.onclick = function(e) {
        e.preventDefault();
        lista.removeChild(li);
      };

      // Área de detalle (desplegable)
      const detalleDiv = document.createElement("div");
      detalleDiv.className = "detalle-div";
      detalleDiv.textContent = valor;
      detalleDiv.style.display = "none";

      li.appendChild(btnDesplegar);
      li.appendChild(span);
      li.appendChild(btnEliminar);
      li.appendChild(detalleDiv);
      lista.appendChild(li);
      entrada.value = "";
    }
  }

  function editarElemento(span, detalleDiv) {
    const textoOriginal = span.textContent;
    const input = document.createElement("input");
    input.type = "text";
    input.value = textoOriginal;
    input.className = "edicion";

    input.onblur = function() {
      const nuevoValor = input.value.trim() || textoOriginal;
      span.textContent = nuevoValor;
      span.title = nuevoValor;
      if (detalleDiv) detalleDiv.textContent = nuevoValor;
      span.ondblclick = function() {
        editarElemento(span, detalleDiv);
      };
      span.style.display = "inline";
      input.remove();
    };

    span.parentNode.insertBefore(input, span);
    span.style.display = "none";
    input.focus();
  }

  // Permitir agregar con Enter
  document.getElementById("entrada").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      agregarElemento();
    }
  });

  // Script para manejar la creación de fechas dinámicas
  function generarInputsFechas() {
    const numDias = parseInt(document.getElementById("num-dias").value) || 1;
    const contenedor = document.getElementById("fechas-dias");
    contenedor.innerHTML = "";
    for (let i = 1; i <= numDias; i++) {
      const label = document.createElement("label");
      label.setAttribute("for", "fecha-dia-" + i);
      label.style.display = "block";
      label.style.marginTop = "10px";
      label.style.fontWeight = "700";
      label.style.color = "var(--guinda)";
      label.textContent = `Fecha y hora del día ${i}:`;

      const input = document.createElement("input");
      input.type = "datetime-local";
      input.id = "fecha-dia-" + i;
      input.name = "fecha-dia-" + i;
      input.style.width = "100%";
      input.style.padding = "10px 14px";
      input.style.marginTop = "5px";
      input.style.boxSizing = "border-box";
      input.style.border = "1.5px solid #C8C8C8";
      input.style.borderRadius = "8px";
      input.style.fontSize = "1rem";
      input.style.background = "var(--gris-claro)";
      input.style.fontFamily = "'Open Sans', Arial, sans-serif";
      input.style.marginBottom = "8px";
      input.style.color = "var(--negro)";

      contenedor.appendChild(label);
      contenedor.appendChild(input);
    }
  }

  document.getElementById("num-dias").addEventListener("input", generarInputsFechas);
  window.addEventListener("DOMContentLoaded", generarInputsFechas);

  // --- DOCENTES Y COORDINADORES DINÁMICOS ---
  function cargarOpcionesDesdeStorage() {
    const docentes = JSON.parse(localStorage.getItem('docentesSIGEA') || '[]');
    const coordinadores = JSON.parse(localStorage.getItem('coordinadoresSIGEA') || '[]');
    actualizarSelect('docente', docentes);
    actualizarSelect('docente2', docentes);
    actualizarSelect('coordinador', coordinadores);
  }

  function actualizarSelect(id, opciones) {
    const select = document.getElementById(id);
    if (!select) return;
    const placeholder = select.options[0];
    select.innerHTML = '';
    select.appendChild(placeholder);
    opciones.forEach(nombre => {
      const opt = document.createElement('option');
      opt.value = nombre;
      opt.textContent = nombre;
      select.appendChild(opt);
    });
  }

  function agregarDocente() {
    const input = document.getElementById('nuevo-docente');
    const nombre = input.value.trim();
    if (nombre) {
      let docentes = JSON.parse(localStorage.getItem('docentesSIGEA') || '[]');
      if (!docentes.includes(nombre)) {
        docentes.push(nombre);
        localStorage.setItem('docentesSIGEA', JSON.stringify(docentes));
        actualizarSelect('docente', docentes);
        actualizarSelect('docente2', docentes);
      }
      input.value = '';
    }
    renderDocentesEliminables();
  }

  function agregarCoordinador() {
    const input = document.getElementById('nuevo-coordinador');
    const nombre = input.value.trim();
    if (nombre) {
      let coordinadores = JSON.parse(localStorage.getItem('coordinadoresSIGEA') || '[]');
      if (!coordinadores.includes(nombre)) {
        coordinadores.push(nombre);
        localStorage.setItem('coordinadoresSIGEA', JSON.stringify(coordinadores));
        actualizarSelect('coordinador', coordinadores);
      }
      input.value = '';
    }
    renderCoordinadoresEliminables();
  }

  function eliminarDocente(nombre) {
    let docentes = JSON.parse(localStorage.getItem('docentesSIGEA') || '[]');
    docentes = docentes.filter(d => d !== nombre);
    localStorage.setItem('docentesSIGEA', JSON.stringify(docentes));
    actualizarSelect('docente', docentes);
    actualizarSelect('docente2', docentes);
    renderDocentesEliminables();
  }

  function renderDocentesEliminables() {
    const docentes = JSON.parse(localStorage.getItem('docentesSIGEA') || '[]');
    const cont = document.getElementById('docentes-eliminables');
    if (!cont) return;
    cont.innerHTML = '';
    docentes.forEach(nombre => {
      const div = document.createElement('div');
      div.style.display = 'flex';
      div.style.alignItems = 'center';
      div.style.gap = '8px';
      div.style.marginBottom = '2px';
      div.innerHTML = `<span>${nombre}</span>`;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.title = 'Eliminar';
      btn.innerHTML = '🗑️';
      btn.style.background = 'transparent';
      btn.style.border = 'none';
      btn.style.cursor = 'pointer';
      btn.onclick = () => eliminarDocente(nombre);
      div.appendChild(btn);
      cont.appendChild(div);
    });
  }

  function eliminarCoordinador(nombre) {
    let coordinadores = JSON.parse(localStorage.getItem('coordinadoresSIGEA') || '[]');
    coordinadores = coordinadores.filter(c => c !== nombre);
    localStorage.setItem('coordinadoresSIGEA', JSON.stringify(coordinadores));
    actualizarSelect('coordinador', coordinadores);
    renderCoordinadoresEliminables();
  }

  function renderCoordinadoresEliminables() {
    const coordinadores = JSON.parse(localStorage.getItem('coordinadoresSIGEA') || '[]');
    const cont = document.getElementById('coordinadores-eliminables');
    if (!cont) return;
    cont.innerHTML = '';
    coordinadores.forEach(nombre => {
      const div = document.createElement('div');
      div.style.display = 'flex';
      div.style.alignItems = 'center';
      div.style.gap = '8px';
      div.style.marginBottom = '2px';
      div.innerHTML = `<span>${nombre}</span>`;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.title = 'Eliminar';
      btn.innerHTML = '🗑️';
      btn.style.background = 'transparent';
      btn.style.border = 'none';
      btn.style.cursor = 'pointer';
      btn.onclick = () => eliminarCoordinador(nombre);
      div.appendChild(btn);
      cont.appendChild(div);
    });
  }

  window.addEventListener('DOMContentLoaded', cargarOpcionesDesdeStorage);

  // --- GRUPOS DINÁMICOS ---
  // --- GRUPOS DINÁMICOS CON CHECKBOXES Y DESPLEGABLE ---
  function cargarGruposDesdeStorage() {
    const grupos = JSON.parse(localStorage.getItem('gruposSIGEA') || '[]');
    actualizarListaGrupos(grupos);
  }

  function actualizarListaGrupos(grupos) {
    const lista = document.getElementById('lista-grupos');
    lista.innerHTML = '';
    grupos.forEach(grupo => {
      const id = 'grupo_' + grupo.replace(/\s+/g, '_');
      const label = document.createElement('label');

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = grupo;
      checkbox.id = id;
      checkbox.name = 'grupos_asignados';

      checkbox.onchange = mostrarGruposSeleccionados;

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(' ' + grupo));
      lista.appendChild(label);
    });
  }

  function agregarGrupo() {
    const input = document.getElementById('nuevo-grupo');
    const grupo = input.value.trim();
    if (grupo) {
      let grupos = JSON.parse(localStorage.getItem('gruposSIGEA') || '[]');
      if (!grupos.includes(grupo)) {
        grupos.push(grupo);
        localStorage.setItem('gruposSIGEA', JSON.stringify(grupos));
        actualizarListaGrupos(grupos);
      }
      input.value = '';
    }
    renderGruposEliminables();
  }

  function eliminarGrupo(nombre) {
    let grupos = JSON.parse(localStorage.getItem('gruposSIGEA') || '[]');
    grupos = grupos.filter(g => g !== nombre);
    localStorage.setItem('gruposSIGEA', JSON.stringify(grupos));
    actualizarListaGrupos(grupos);
    renderGruposEliminables();
  }

  function renderGruposEliminables() {
    const grupos = JSON.parse(localStorage.getItem('gruposSIGEA') || '[]');
    const cont = document.getElementById('grupos-eliminables');
    if (!cont) return;
    cont.innerHTML = '';
    grupos.forEach(nombre => {
      const div = document.createElement('div');
      div.style.display = 'flex';
      div.style.alignItems = 'center';
      div.style.gap = '8px';
      div.style.marginBottom = '2px';
      div.innerHTML = `<span>${nombre}</span>`;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.title = 'Eliminar';
      btn.innerHTML = '🗑️';
      btn.style.background = 'transparent';
      btn.style.border = 'none';
      btn.style.cursor = 'pointer';
      btn.onclick = () => eliminarGrupo(nombre);
      div.appendChild(btn);
      cont.appendChild(div);
    });
  }

  function mostrarGruposSeleccionados() {
    const checkboxes = document.querySelectorAll('#lista-grupos input[type="checkbox"]:checked');
    const seleccionados = Array.from(checkboxes).map(cb => cb.value);
    document.getElementById('grupos-seleccionados').textContent =
      seleccionados.length ? 'Seleccionados: ' + seleccionados.join(', ') : '';
  }

  // Mostrar/ocultar lista de grupos
  document.getElementById('toggle-grupos').addEventListener('click', function() {
    const lista = document.getElementById('lista-grupos');
    lista.style.display = (lista.style.display === 'none' || lista.style.display === '') ? 'block' : 'none';
  });

  // Cerrar el desplegable si se hace clic fuera
  document.addEventListener('click', function(e) {
    const lista = document.getElementById('lista-grupos');
    const toggle = document.getElementById('toggle-grupos');
    if (!lista.contains(e.target) && e.target !== toggle) {
      lista.style.display = 'none';
    }
  });

  // Inicializar grupos, docentes y coordinadores al cargar
  window.addEventListener('DOMContentLoaded', function() {
    cargarOpcionesDesdeStorage();
    cargarGruposDesdeStorage();
    renderDocentesEliminables();
    renderCoordinadoresEliminables();
    renderGruposEliminables();
  });

</script>
</body>
</html>